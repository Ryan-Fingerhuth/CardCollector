<form [formGroup]="setFormGroup">
  <!-- Header -->
  <div class="row mb-3">
    <div class="col">
      <div *ngIf="!changeSetName" class="row">
        <div class="col-auto">
          <h4 class="set-title">{{ setDescription }}</h4>
          <div
            *ngIf="set.defaultSet"
            class="text-bg-info default-set-label ms-4"
          >
            Default Set
          </div>
        </div>
        <div class="col-auto" *ngIf="editMode">
          <i
            class="pi pi-pencil pi-md mb-2 vertical-center-icons"
            placement="top"
            ngbTooltip="Edit"
            (click)="onChangeSetName()"
          ></i>
        </div>
      </div>

      <div *ngIf="changeSetName" class="row">
        <div class="col-4">
          <input
            type="text"
            class="form-control"
            formControlName="setDescription"
            placeholder="enter set name..."
          />
        </div>
        <div class="col-auto">
          <i
            class="pi pi-check pi-md vertical-center-icons"
            placement="top"
            ngbTooltip="Confirm"
            (click)="onChangeSetName()"
          ></i>
        </div>
      </div>
    </div>
    <div class="col-auto" *ngIf="editMode">
      <button class="btn btn-primary me-1" (click)="onAddCards()">
        Add Cards
      </button>
      <button
        class="btn btn-success ms-1"
        [disabled]="setFormGroup.invalid"
        (click)="saveSetInformation()"
      >
        Save
      </button>
    </div>
  </div>
</form>

<!-- Binder View -->
<div class="row mb-3">
  <div class="col">
    <!-- Select Binder Size Option -->
    <div class="row">
      <div class="col">
        <form [formGroup]="binderFormGroup">
          <div class="hstack gap-2">
            <div>Binder Layout:</div>
            <input
              type="radio"
              class="btn-check"
              name="binderLayoutSize"
              id="layout2x2"
              autocomplete="off"
              value="30rem"
              formControlName="binderLayoutSize"
            />
            <label class="btn btn-outline-primary" for="layout2x2">2 x 2</label>

            <input
              type="radio"
              class="btn-check"
              name="binderLayoutSize"
              id="layout3x3"
              autocomplete="off"
              value="40rem"
              formControlName="binderLayoutSize"
            />
            <label class="btn btn-outline-primary" for="layout3x3">3 x 3</label>

            <input
              type="radio"
              class="btn-check"
              name="binderLayoutSize"
              id="layout3x4"
              autocomplete="off"
              value="50rem"
              formControlName="binderLayoutSize"
            />
            <label class="btn btn-outline-primary" for="layout3x4">3 x 4</label>
          </div>
        </form>
      </div>
      <div class="col-auto">
        <div class="hstack gap-2">
          <button class="btn btn-primary ms-1" (click)="removePage()">
            Remove Page
          </button>
          <button class="btn btn-primary ms-1" (click)="addPage()">
            Add Page
          </button>
        </div>
      </div>
    </div>
    <div>
      <nav aria-label="Binder Navigation">
        <ul class="pagination justify-content-center">
          <li class="page-item">
            <button class="page-link" (click)="goToPreviousPage()">
              Previous
            </button>
          </li>
          <li
            *ngFor="let page of [].constructor(totalPageNumber); let i = index"
            [ngClass]="currentPageNumber === i + 1 ? 'active' : 'inactive'"
            class="page-item"
          >
            <button class="page-link" (click)="goToThisPage(i + 1)">
              {{ i + 1 }}
            </button>
          </li>
          <li class="page-item">
            <button class="page-link" (click)="goToNextPage()">Next</button>
          </li>
        </ul>
      </nav>
    </div>

    <!-- Binder Layout -->
    <div class="container">
      Layout: {{ this.binderFormGroup.controls["binderLayoutSize"].value }} |
      Total Pages: {{ totalPageNumber }} | currentPage:
      {{ currentPageNumber }} | numberOfCardsPerPage: {{ numberOfCardsPerPage }}
      <!-- | carouselListIds: {{ carouselListIds | json }} |
      binderLayoutIds: {{ binderLayoutIds | json }} -->

      <div class="mb-3">
        <div
          class="categories"
          [style.width]="binderLayoutWidth"
          cdkDropListGroup
        >
          <ng-container
            *ngFor="let card of currentBinderPageCards; let i = index"
          >
            <div
              class="categories-item"
              cdkDropList
              cdkDropListOrientation="horizontal"
              [cdkDropListData]="{ item: card, index: i }"
              [cdkDropListConnectedTo]="carouselListIds"
              (cdkDropListDropped)="binderDrop($event)"
            >
              <div cdkDrag class="inner">
                <div *cdkDragPlaceholder></div>
                <div class="vstack gap-1">
                  <div
                    *ngIf="editMode"
                    class="d-flex justify-content-evenly mb-1"
                  >
                    <div>
                      <input
                        class="form-check-input lower-checkbox cursor-point"
                        type="checkbox"
                        id="{{ 'flexCheckDefault' + i + ' ' + ii }}"
                        placement="top"
                        ngbTooltip="Obtained"
                      />
                    </div>

                    <div
                      class="cursor-move vertical-center-icons"
                      cdkDragHandle
                    >
                      <svg width="20px" fill="currentColor" viewBox="0 0 24 24">
                        <path
                          d="M10 9h4V6h3l-5-5-5 5h3v3zm-1 1H6V7l-5 5 5 5v-3h3v-4zm14 2l-5-5v3h-3v4h3v3l5-5zm-9 3h-4v3H7l5 5 5-5h-3v-3z"
                        ></path>
                        <path d="M0 0h24v24H0z" fill="none"></path>
                      </svg>
                    </div>

                    <i
                      class="pi pi-trash pi-md vertical-center-icons"
                      placement="top"
                      ngbTooltip="Remove"
                    ></i>
                  </div>
                  <div>{{ card.uniqueId }}</div>
                  <div *ngIf="card.id === 0" class="empty-card">Empty Card</div>
                  <img
                    *ngIf="card.id > 0"
                    [src]="cardService.getImage(card.thumbnailImageGuid, true)"
                    class="image-thumbnail"
                    [ngClass]="!card.cardObtained ? 'card-opacity' : ''"
                  />
                  <div *ngIf="card.id !== 0" class="card-info">
                    {{ card.cardName }}
                  </div>
                  <div *ngIf="card.id !== 0" class="card-info">
                    {{ card.originalSetName }} - ({{ card.yearReleased }})
                  </div>
                </div>
              </div>
            </div>
          </ng-container>
        </div>

        <!-- PrimeNG Carousel -->
        <div>
          <div
            id="{{ 'carousel-list-0' }}"
            cdkDropList
            cdkDropListOrientation="horizontal"
            [cdkDropListConnectedTo]="binderLayoutIds"
            [cdkDropListDisabled]="!editMode"
          >
            <p-carousel
              [value]="carouselCardList"
              [numVisible]="6"
              [numScroll]="1"
              [responsiveOptions]="responsiveOptions"
              [circular]="false"
              [showIndicators]="false"
            >
              <ng-template let-card pTemplate="item">
                <div cdkDrag [cdkDragData]="card" class="slider-item">
                  <div *cdkDragPlaceholder></div>
                  <img
                    [src]="cardService.getImage(card.thumbnailImageGuid, true)"
                    class="image-thumbnail image-display-block"
                  />
                </div>
              </ng-template>
            </p-carousel>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Card List -->
<div class="row">
  <div class="col">
    <div class="example-container">
      <div cdkDropListGroup>
        <ng-container *ngFor="let cardRow of cardRows; let i = index">
          <div
            cdkDropList
            cdkDropListOrientation="horizontal"
            [cdkDropListData]="cardRow"
            [cdkDropListDisabled]="!editMode"
            class="example-list"
            cdkDragStarted
            (cdkDropListDropped)="drop($event)"
          >
            <div
              cdkDrag
              class="example-box"
              *ngFor="let card of cardRow; let ii = index"
              [cdkDragData]="card"
            >
              <div class="vstack gap-1">
                <!-- Item Header - Display obtained, move, and delete controls -->
                <div
                  *ngIf="editMode"
                  class="d-flex justify-content-evenly mb-1"
                >
                  <div>
                    <input
                      class="form-check-input lower-checkbox cursor-point"
                      type="checkbox"
                      [checked]="card.cardObtained"
                      (change)="onObtainedChanged(card, $event)"
                      id="{{ 'flexCheckDefault' + i + ' ' + ii }}"
                      placement="top"
                      ngbTooltip="Obtained"
                    />
                  </div>

                  <div
                    class="cursor-move vertical-center-icons"
                    placement="top"
                    ngbTooltip="Move"
                    cdkDragHandle
                  >
                    <svg width="20px" fill="currentColor" viewBox="0 0 24 24">
                      <path
                        d="M10 9h4V6h3l-5-5-5 5h3v3zm-1 1H6V7l-5 5 5 5v-3h3v-4zm14 2l-5-5v3h-3v4h3v3l5-5zm-9 3h-4v3H7l5 5 5-5h-3v-3z"
                      ></path>
                      <path d="M0 0h24v24H0z" fill="none"></path>
                    </svg>
                  </div>

                  <i
                    class="pi pi-trash pi-md vertical-center-icons"
                    placement="top"
                    ngbTooltip="Remove"
                    (click)="onDeleteCard(cardRow, card)"
                  ></i>
                </div>
                <img
                  [src]="cardService.getImage(card.thumbnailImageGuid, true)"
                  class="image-thumbnail"
                  [ngClass]="!card.cardObtained ? 'card-opacity' : ''"
                />
                <div class="card-info">
                  {{ card.cardName }}
                </div>
                <div class="card-info">
                  {{ card.originalSetName }} - ({{ card.yearReleased }})
                </div>
              </div>
            </div>
          </div>
        </ng-container>
      </div>
    </div>
  </div>
</div>
